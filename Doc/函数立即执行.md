# 无名英雄——（）

* 通过一段代码简单认识这位无名英雄

```javascript
(function() {
    document.write('hello world my name is Unknown Hero')
}())
```

* 没错这个无名英雄就是匿名函数

## 匿名函数立即执行

* IIFE：Immediately-invoked function expression

* 意为立即调用的函数表达式，也就是说，声明函数的同时立即调用这个函数。

* 函数声明、函数表达式、匿名函数

  函数声明：function fn（）{...}

  函数表达式：var fn = function（）{...}

  匿名函数：function（）{...}

  * 区别
  * 函数声明会提升
  * 函数表达式必须等到Javascirtp引擎执行到它所在行时
  * 函数表达式后面可以加括号立即调用该函数，函数声明不可以，只能以fn()形式调用

  



## 为什么需要IFFE

1. 弥足js在作用域（scope）方面的缺陷：

   * js只有全局作用域（global scope）、函数作用域（function scope）；

   * es6新增块级作用域（blank scope）；

2. 在js中只要function可以隔离作用域，因此如果要将一段代码中的变量、函数等的定义隔离出来，只能将这段代码封装到一个函数中。

3. 在JS中，当然声明函数的目的在大多数情况下也是为了复用，但是JS迫于作用域控制手段的贫乏，我们也经常看到只使用一次的函数：这通常的目的是为了隔离作用域了！既然只使用一次，那么立即执行好了！既然只使用一次，函数的名字也省掉了！这就是IIFE的由来。



例子1：全局作用域

```
for (var i = 0; i < 5; i++) {
}
console.log(i); //5

// var => let 就是块级作用域 i会报错
```

例子2：函数作用域

```
(function() {
//此处是块级（私有）作用域
})()
```

以上代码定义并立即调用了一个匿名函数。将函数声明包含在一对圆括号中，表示它实际上是一个函数表达式。

* 看看这种写法是如何产生的

```
var a = function() {
console.log(123);
};

a(); //123
```

既然这种方式可以立即执行一个函数，那也就意味着将匿名函数赋值给一个变量就完全没有意义了。

```
function() {
console.log(123);
}();
//SyntaxError: function statement requires a name
```

这段代码会导致语法错误，是因为Javascript将function关键字当作一个函数声明的开始，而函数声明后面是不能跟圆括号的（匿名函数是函数声明的一种）。然而，**函数表达式的后面可以跟圆括号。要将函数声明转换成函数表达式，**
只要像下面这样给它加上一对圆括号即可。

* 函数名没意义，所以使用匿名函数
* 第一个圆括号：将匿名函数转换为函数表达式。
* 第二个圆括号：立即执行匿名函数

```
(function() {
console.log(123);
})()
```





## js怎么解析IFFE

* 为什么这样就能立即执行并且不报错呢？
* 因为在javascript里，括号内部不能包含语句，当解析器对代码进行解释的时候，先碰到了()，然后碰到`function关键字就会自动将()`里面的代码识别为`函数表达式`而不是函数声明。
* **碰到function关键字就会自动将()里面的代码识别为`函数表达式`而不是函数声明。**

例子:

```javascript
var name = 'window'
var obj = {
    name: 'obj',
    fn:function() {
        console.log(this.name)
    }
}
var person = {
    name: 'person'
}; 
(person.fn = obj.fn)() // name为？
```

* 匿名函数前的分号必须加
* this -> window



## 常见的使用方式

* 加括号是最安全的做法

```
(function(){
    
}());

(function(){
    
})();
// jquery
( function (window,undefined){…jquery代码…} (window) 
```

* 一元运算符
* ！、~、+、-等运算符还会和函数的返回值进行运算，有时造成不必要的麻烦

```
!function(){}();
~function(){}();
-function(){}();
+function(){}();
```























var a = 10;

(function(){

console.log(a)

a = 5

console.log(window.a)

var a =20;

console.log(a)

})()